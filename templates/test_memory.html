<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Memory Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Added dyslexia-friendly font configuration -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'dyslexia': ['OpenDyslexic', 'Comic Sans MS', 'Arial', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-dyslexia bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-purple-900 dark:to-indigo-900 min-h-screen text-gray-900 dark:text-white">
  <div class="max-w-3xl mx-auto p-6">
    <header class="mb-8">
      <h1 class="text-3xl font-bold mb-2">ðŸ§  Nonword Repetition Memory Test</h1>
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        You will see nonsense words of different lengths. Your task is to repeat or type each word exactly as you remember it.
        This checks how well you can hold unfamiliar sounds in memory.
      </p>
      <div class="bg-blue-50 dark:bg-gray-800/60 border border-blue-100 dark:border-gray-700 rounded-xl p-4 text-sm mb-4">
        <p class="mb-1"><strong>How this test works:</strong></p>
        <ul class="list-disc pl-5 space-y-1">
          <li>This test shows one item at a time. Type your answer before moving to the next.</li>
          <li>A timer is running in the background. Only counselors/admins can see the time.</li>
          <li>When you finish the last item, your answers will be submitted.</li>
        </ul>
      </div>
      <div class="bg-white/80 dark:bg-gray-800/80 border border-gray-200 dark:border-gray-700 rounded-xl p-4 text-sm">
        <p class="mb-1"><strong>The test has three levels:</strong></p>
        <ul class="list-disc pl-5 space-y-1">
          <li>Level 1: 3-syllable words (moderately difficult)</li>
          <li>Level 2: 4-syllable words (harder)</li>
          <li>Level 3: 5-syllable words (very challenging)</li>
        </ul>
        <p class="mt-3 text-gray-700 dark:text-gray-300">Try your best! Even if a word looks strange, just focus on remembering the sounds.</p>
        <p class="mt-2 text-xs text-gray-500">Note: This page is for an educational school project and is not a diagnostic tool.</p>
      </div>
    </header>

    <form id="memoryForm" method="POST" class="bg-white/80 dark:bg-gray-800/80 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 space-y-8">
      <!-- pass user name/email for server-side saving -->
      <input type="hidden" name="name" value="{{ session.get('user_name', '') }}" />
      <input type="hidden" name="email" value="{{ user.email if user else '' }}" />
      <input type="hidden" name="runtime" id="runtime" value="" />

      <!-- Flashcard item container: render all items, show one at a time -->
      <div id="flashcards" class="space-y-6">
        {% set words_l1 = ['balino', 'mepuda', 'tobigo', 'radeku'] %}
        {% set words_l2 = ['parimelo', 'tanobeko', 'melobari', 'lopunedo'] %}
        {% set words_l3 = ['somelunadi', 'parimotelu', 'dinokemata', 'rubolaneko'] %}

        {% for w in words_l1 %}
        <div class="flashcard-item" data-level="1" style="display:none;">
          <h2 class="text-xl font-semibold mb-3">Level 1 Â· 3-syllable words</h2>
          <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Word: <span class="font-semibold">{{ w }}</span></label>
          <input type="hidden" name="target" value="{{ w }}" />
          <input type="hidden" name="level" value="1" />
          <input type="text" name="recall" placeholder="Type the word exactly as shown" class="w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        {% endfor %}

        {% for w in words_l2 %}
        <div class="flashcard-item" data-level="2" style="display:none;">
          <h2 class="text-xl font-semibold mb-3">Level 2 Â· 4-syllable words</h2>
          <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Word: <span class="font-semibold">{{ w }}</span></label>
          <input type="hidden" name="target" value="{{ w }}" />
          <input type="hidden" name="level" value="2" />
          <input type="text" name="recall" placeholder="Type the word exactly as shown" class="w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        {% endfor %}

        {% for w in words_l3 %}
        <div class="flashcard-item" data-level="3" style="display:none;">
          <h2 class="text-xl font-semibold mb-3">Level 3 Â· 5-syllable words</h2>
          <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Word: <span class="font-semibold">{{ w }}</span></label>
          <input type="hidden" name="target" value="{{ w }}" />
          <input type="hidden" name="level" value="3" />
          <input type="text" name="recall" placeholder="Type the word exactly as shown" class="w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" />
        </div>
        {% endfor %}
      </div>

      <div class="pt-2 flex items-center justify-between">
        <div id="progressText" class="text-sm text-gray-600 dark:text-gray-300">Item 1 of 12</div>
        <button id="nextBtn" type="button" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold rounded-xl">Next</button>
      </div>
    </form>
  </div>
<script>
(function(){
  const items = Array.from(document.querySelectorAll('.flashcard-item'));
  const nextBtn = document.getElementById('nextBtn');
  const progressEl = document.getElementById('progressText');
  const form = document.getElementById('memoryForm');
  const runtimeInput = document.getElementById('runtime');
  let idx = 0;
  const total = items.length;
  const start = Date.now();

  function updateProgress(){
    if (progressEl) progressEl.textContent = `Item ${Math.min(idx+1, total)} of ${total}`;
  }

  function show(i){
    items.forEach((el, k) => el.style.display = (k === i) ? '' : 'none');
    updateProgress();
    const input = items[i].querySelector('input[type="text"]');
    if (input) input.focus();
    if (i === total - 1) {
      nextBtn.textContent = 'Submit';
    } else {
      nextBtn.textContent = 'Next';
    }
  }

  function recordRuntime(){
    const elapsed = Math.round((Date.now() - start)/1000);
    if (runtimeInput) runtimeInput.value = String(elapsed);
  }

  if (items.length > 0) show(0);
  updateProgress();

  nextBtn.addEventListener('click', function(){
    // If last item, submit
    if (idx === total - 1) {
      recordRuntime();
      form.submit();
      return;
    }
    idx += 1;
    show(idx);
  });

  form.addEventListener('submit', function(){
    recordRuntime();
  });
})();
</script>
</body>
</html>
